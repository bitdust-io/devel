#
# docker-compose.yml
#
# Copyright (C) 2008-2019 Stanislav Evseev, Veselin Penev  https://bitdust.io
#
# This file (docker-compose.yml) is part of BitDust Software.
#
# BitDust is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# BitDust Software is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with BitDust Software.  If not, see <http://www.gnu.org/licenses/>.
#
# Please contact us if you have any questions at bitdust.io@gmail.com

version: "3.4"

services:

  _base_image:
    build:
      dockerfile: regression/Dockerfiles/bitdust_install/Dockerfile
      context: ./../
    image: bitdust-baseimage
    entrypoint: ""
    command: /bin/false



  identity-server:
    image: bitdust-baseimage
    ports:
        - "22201:22"

  identity-server-a:
    image: bitdust-baseimage
    ports:
        - "22202:22"

  identity-server-b:
    image: bitdust-baseimage
    ports:
        - "22203:22"

  identity-server-dead:
    image: bitdust-baseimage
    ports:
        - "22204:22"



  stun_1:
    image: bitdust-baseimage
    ports:
      - "22211:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"

  stun_2:
    image: bitdust-baseimage
    ports:
      - "22212:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"



  dht_seed_0:
    image: bitdust-baseimage
    ports:
      - "22220:22"

  dht_seed_1:
    image: bitdust-baseimage
    ports:
      - "22221:22"
    links:
      - "dht_seed_0"

  dht_seed_2:
    image: bitdust-baseimage
    ports:
      - "22222:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"

#   dht_seed_3:
#     image: bitdust-baseimage
#     ports:
#       - "22223:22"
#     links:
#       - "dht_seed_0"
#       - "dht_seed_1"
#       - "dht_seed_2"

#   dht_seed_4:
#     image: bitdust-baseimage
#     ports:
#       - "22224:22"
#     links:
#       - "dht_seed_0"
#       - "dht_seed_1"
#       - "dht_seed_2"
#       - "dht_seed_3"



  proxy_server_1:
    image: bitdust-baseimage
    ports:
      - "22231:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"

  proxy_server_2:
    image: bitdust-baseimage
    ports:
      - "22232:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"

#   proxy_server_3:
#     image: bitdust-baseimage
#     ports:
#       - "22233:22"
#     links:
#       - "dht_seed_0"
#       - "dht_seed_1"
#       - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
#       - "stun_1"
#       - "stun_2"
#       - "identity-server:is"
#       - "identity-server-a:is_a"
#       - "identity-server-b:is_b"
#       - "identity-server-dead:is_dead"

#   proxy_server_4:
#     image: bitdust-baseimage
#     ports:
#       - "22234:22"
#     links:
#       - "dht_seed_0"
#       - "dht_seed_1"
#       - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
#       - "stun_1"
#       - "stun_2"
#       - "identity-server:is"
#       - "identity-server-a:is_a"
#       - "identity-server-b:is_b"
#       - "identity-server-dead:is_dead"



  supplier_1:
    image: bitdust-baseimage
    ports:
      - "22241:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"

  supplier_2:
    image: bitdust-baseimage
    ports:
      - "22242:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"

  supplier_3:
    image: bitdust-baseimage
    ports:
      - "22243:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"

  supplier_4:
    image: bitdust-baseimage
    ports:
      - "22244:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"

  supplier_5:
    image: bitdust-baseimage
    ports:
      - "22245:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"

  supplier_6:
    image: bitdust-baseimage
    ports:
      - "22246:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"



  customer_1:
    image: bitdust-baseimage
    ports:
      - "22251:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"
    volumes:
      - customer_1:/customer_1

  customer_2:
    image: bitdust-baseimage
    ports:
      - "22252:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"
    volumes:
      - customer_2:/customer_2

  customer_3:
    image: bitdust-baseimage
    ports:
      - "22253:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"
    volumes:
      - customer_3:/customer_3

  customer_4:
    image: bitdust-baseimage
    ports:
      - "22254:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"
    volumes:
      - customer_4:/customer_4

  customer_5:
    image: bitdust-baseimage
    ports:
      - "22255:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"
    volumes:
      - customer_5:/customer_5

  customer_6:
    image: bitdust-baseimage
    ports:
      - "22256:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"
    volumes:
      - customer_6:/customer_6

  customer_backup:
    image: bitdust-baseimage
    ports:
      - "22257:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"
    volumes:
      - customer_backup:/customer_backup

  customer_restore:
    image: bitdust-baseimage
    ports:
      - "22258:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"
    volumes:
      - customer_restore:/customer_restore

  customer_7:
    image: bitdust-baseimage
    ports:
      - "22259:22"
    links:
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "stun_1"
      - "stun_2"
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"
    volumes:
      - customer_7:/customer_7



  tester:
    build:
      context: ./../
      dockerfile: regression/Dockerfiles/tester/Dockerfile
    links:
      - "identity-server:is"
      - "identity-server-a:is_a"
      - "identity-server-b:is_b"
      - "identity-server-dead:is_dead"
      - "stun_1"
      - "stun_2"
      - "dht_seed_0"
      - "dht_seed_1"
      - "dht_seed_2"
#       - "dht_seed_3"
#       - "dht_seed_4"
      - "proxy_server_1"
      - "proxy_server_2"
#       - "proxy_server_3"
#       - "proxy_server_4"
      - "supplier_1"
      - "supplier_2"
      - "supplier_3"
      - "supplier_4"
      - "supplier_5"
      - "supplier_6"
      - "customer_1"
      - "customer_2"
      - "customer_3"
      - "customer_4"
      - "customer_5"
      - "customer_6"
      - "customer_backup"
      - "customer_restore"
      - "customer_7"
    image: bitdust/tester
    cap_add:
      - SYS_PTRACE
    privileged: true
    volumes:
      - customer_1:/customer_1
      - customer_2:/customer_2
      - customer_3:/customer_3
      - customer_4:/customer_4
      - customer_5:/customer_5
      - customer_6:/customer_6
      - customer_backup:/customer_backup
      - customer_restore:/customer_restore
      - customer_7:/customer_7

    stdin_open: true
    tty: true



volumes:
  customer_1:
  customer_2:
  customer_3:
  customer_4:
  customer_5:
  customer_6:
  customer_backup:
  customer_restore:
  customer_7:
